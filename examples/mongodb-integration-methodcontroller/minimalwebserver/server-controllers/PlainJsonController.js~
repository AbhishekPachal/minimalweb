/**
 * Example Controller to get Json
 * A controller which can be used to get Json as response
 */

var logger = require('minimalweb').logger;
var controller = require('minimalweb').abstractController;

var userwork = require('../dataaccess/userdao');


var selfController = function () {
	logger.log("selfController constructed");
}

//Extends abstract controller
selfController.__proto__ = controller;

selfController.processRequest = function(req,res) {
	res.setHeader("Access-Control-Allow-Origin", "http://localhost");
	res.setHeader("Access-Control-Allow-Methods", "GET, POST");

	// process specific business logic
	// set the processed string to controller setJson method
	// place to use any service callback

	userwork.getUser(function (err, userString) {
		console.log(userString);
	
		if (err) {
		  res.send(HTTPStatus.INTERNAL_SERVER_ERROR,'Internal Server Error');
		}

		if(userString.length>0)
		{
			selfController.setJson(userString);
		}
		else
		{
			selfController.setJson("{\"error\":\"No Such Data\"}");
		}
		selfController.process(req,res,function(err,content){
			console.log('content -'+content);
		});
	  });
}

module.exports.getPlainJsonController = function() {
	return selfController;
};


